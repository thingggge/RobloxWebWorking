<!doctype html>
<html lang="en">
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<!-- Now.gg prebid & ad scripts -->
<script src="https://dn0qt3r0xannq.cloudfront.net/nowgg-IZQznjkQaj/video/prebid-load.js" onload="window.imaError=!1" onerror="window.imaError=!0"></script>

<!-- Google Tag Manager -->
<script>window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-PRM8BWR"></script>
<script src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>

<script>
function isMobile(){
    return [/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i,/Opera Mini/i,/IEMobile/i,/WPDesktop/i]
    .some(e=>navigator.userAgent.match(e) || /iPad|iPhone|iPod/.test(navigator.platform) ||
    ("MacIntel"===navigator.platform && navigator.maxTouchPoints>1))
}

var adUnitDimensions=[[300,250],[336,280],[480,320]],
    midRollAdUnitDimensions=[[336,280],[300,250]];
isMobile()&&(adUnitDimensions=[[300,250]]);
window.googletag=window.googletag||{cmd:[]};

googletag.cmd.push(function(){
    window.preRollSlot = googletag.defineSlot("/22663423128/pre-game-display", adUnitDimensions, "div-gpt-ad-1642440975217-0").addService(googletag.pubads());
    window.midRollSlot = googletag.defineSlot("/22663423128/in-game-floating-display", midRollAdUnitDimensions, "div-gpt-ad-1642440975217-1").addService(googletag.pubads());
    window.skyScrapperFirst = googletag.defineSlot("/22663423128/ingamedisplay", [[160,600]], "div-gpt-ad-skyScrapper-1").addService(googletag.pubads());
    window.skyScrapperSecond = googletag.defineSlot("/22663423128/ingamedisplay", [[160,600]], "div-gpt-ad-skyScrapper-2").addService(googletag.pubads());
    window.leaderBoardFirst = googletag.defineSlot("/22663423128/ingamedisplay", [[970,90],[728,90]], "div-gpt-ad-leaderBoard-1").addService(googletag.pubads());
    window.leaderBoardSecond = googletag.defineSlot("/22663423128/ingamedisplay", [[970,90],[728,90]], "div-gpt-ad-leaderBoard-2").addService(googletag.pubads());
    googletag.pubads().disableInitialLoad();
    googletag.pubads().enableSingleRequest();
    googletag.enableServices();
});
</script>

<script>
// FB Click ID
const fbClickId = new URL(window.location.href).searchParams.get("fbclid");
if(fbClickId){
    const now = new Date();
    now.setDate(now.getDate()+1);
    document.cookie = `fbClickId=${fbClickId}; expires=${now.toUTCString()}; path=/`;
}

// Language detect
let language = (navigator.languages && navigator.languages[0]) || navigator.language || "en";
if(language.indexOf("-") !== -1) language = language.split("-")[0];
window.language = language;

// UTM logic (unchanged)
function getUtms(){
    const url = new URL(window.location.href);
    const dlParam = url.searchParams.get("dl");
    if(dlParam) sessionStorage.setItem("dl", dlParam);

    if(url.searchParams.get("utm_medium") || url.searchParams.get("utm_source") || url.searchParams.get("utm_campaign")){
        const utm_medium = url.searchParams.get("utm_medium") || "NA";
        const utm_source = url.searchParams.get("utm_source") || "NA";
        const utm_campaign = url.searchParams.get("utm_campaign") || "NA";
        sessionStorage.setItem("utm_medium", utm_medium);
        sessionStorage.setItem("utm_source", utm_source);
        sessionStorage.setItem("utm_campaign", utm_campaign);
        const referrer = document.referrer ? document.referrer.split("/")[2] : "NA";
        const expiry = new Date();
        expiry.setHours(expiry.getHours()+24);
        const domain = window.location.hostname;
        document.cookie = `utm_medium=${utm_medium};expires=${expiry};domain=${domain};path=/`;
        document.cookie = `utm_source=${utm_source};expires=${expiry};domain=${domain};path=/`;
        document.cookie = `utm_campaign=${utm_campaign};expires=${expiry};domain=${domain};path=/`;
        return `&utm_medium=${utm_medium}&utm_source=${utm_source}&utm_campaign=${utm_campaign}&referrer=${referrer}` + (dlParam ? `&dl=${dlParam}` : "");
    }
    return dlParam ? `&dl=${dlParam}` : "";
}

window.utmParamsStr = getUtms();

// ULID generator (unchanged)
function ULID(){
    const BASE32 = "0123456789ABCDEFGHJKMNPQRSTVWXYZ".split("");
    let last = -1;
    const ulid = new Uint8Array(16);
    const time = new DataView(ulid.buffer,0,6);
    const rand = new Uint8Array(ulid.buffer,6,10);
    const dest = new Array(26);

    function encode(ulid){
        dest[0]=BASE32[ulid[0]>>5];
        dest[1]=BASE32[ulid[0]&0x1f];
        for(let i=0;i<3;i++){
            dest[i*8+2]=BASE32[ulid[i*5+1]>>3];
            dest[i*8+3]=BASE32[((ulid[i*5+1]<<2)|(ulid[i*5+2]>>6))&0x1f];
            dest[i*8+4]=BASE32[(ulid[i*5+2]>>1)&0x1f];
            dest[i*8+5]=BASE32[((ulid[i*5+2]<<4)|(ulid[i*5+3]>>4))&0x1f];
            dest[i*8+6]=BASE32[((ulid[i*5+3]<<1)|(ulid[i*5+4]>>7))&0x1f];
            dest[i*8+7]=BASE32[(ulid[i*5+4]>>2)&0x1f];
            dest[i*8+8]=BASE32[((ulid[i*5+4]<<3)|(ulid[i*5+5]>>5))&0x1f];
            dest[i*8+9]=BASE32[ulid[i*5+5]&0x1f];
        }
        return dest.join("");
    }

    return function(){
        const now = Date.now();
        if(now===last){
            for(let i=9;i>=0;i--) if(rand[i]++<255) break;
        } else {
            last=now;
            time.setUint16(0,(now/4294967296.0)|0);
            time.setUint32(2,now|0);
            window.crypto.getRandomValues(rand);
        }
        return encode(ulid);
    }
}
window.ULID = ULID;

// Worker/Auth
const authToken = sessionStorage.getItem("userToken");

window.appInfo = { appId: "5349", name: "Roblox", playDomain: true };
window.gameId = window.appInfo.appId;
window.gameName = window.appInfo.name;

const appCampaignData = JSON.parse(sessionStorage.getItem("campaignData")||"{}");

if(window.gameId && !(appCampaignData && appCampaignData.appId===window.gameId && authToken)){
    const searchParams = new URLSearchParams(window.location.search);
    const token="ZEdocGMybHpZV1poYTJWMGIydGxiZw";
    const recaptchaToken="dGhpc2lzYWZha2V0b2tlbg";

    let url=`https://steep-truth-aa08.mhvanheste.workers.dev/?url=https://now.gg/accounts/users/v1/userinfo?locale=${window.language}`;
    url += window.utmParamsStr;

    const sessionId = sessionStorage.getItem("sessionId");
    let userUuid = searchParams.get("sessionId") || sessionId || ULID()();
    sessionStorage.setItem("sessionId", userUuid);

    const data = {
        appId: window.gameId,
        token,
        sessionId: userUuid,
        recaptchaToken,
        adTrackingId: window.adTrackingId
    };

    window.sessionId = userUuid;
    window[`${window.gameId}-auth`] = fetch(url,{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization": authToken ? `Bearer ${authToken}` : ""
        },
        body: JSON.stringify(data)
    });
}

// Service worker
window.isLocalhost = /^(localhost|127\.0\.0\.1|::1)$/.test(window.location.hostname);
if("serviceWorker" in navigator){
    window.addEventListener("load",()=>{
        if(!window.isLocalhost){
            navigator.serviceWorker.register(`play/sw.js`);
        }
    });
}

// replaceAll polyfill
if(!String.prototype.replaceAll){
    String.prototype.replaceAll=function(str,newStr){
        if(Object.prototype.toString.call(str).toLowerCase()==="[object regexp]") return this.replace(str,newStr);
        return this.replace(new RegExp(str,'g'),newStr);
    }
}
</script>

<link rel="stylesheet" href="play/style.css">

<title>Play Roblox Online™</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,shrink-to-fit=no,maximum-scale=1,user-scalable=no"/>
</head>

<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PRM8BWR" height="0" width="0" style="display:none;"></iframe></noscript>

<div class="app">

    <!-- Orientation elements (needed) -->
    <div id="orientation-wrapper">
        <div id="portrait-block"></div>
        <div id="landscape-block"></div>
    </div>

    <div class="snackbar"></div>
    <div id="loader"><img class="loaderImage" alt="loaderImg" src="play/images/loader.svg"/></div>
</div>

<script>
const favIcon = window.isWhiteLabelledApp ? "nutaku_favicon.ico" : "favicon.ico";
const link = document.createElement('link');
link.rel = 'icon';
document.getElementsByTagName('head')[0].appendChild(link);
link.href = `/play/images/${favIcon}`;
</script>

<!-- ⭐ MOVED TO BOTTOM SO .app EXISTS BEFORE JS RUNS ⭐ -->
<script src="play/vendors_app.ae4a4a45.chunk.js"></script>
<script src="play/app.af8c356a.js"></script>

</body>
</html>
